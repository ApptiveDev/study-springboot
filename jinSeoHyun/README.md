# study-springboot
백엔드 개발자를 위한 스프링부트 스터디

# 📕 ERD(Entity-Relationship Diagram) 설계 정리
- **Etity**개체와 **Relationship**관계를 중점적으로 표시해 데이터베이스 구조를 나타낸 다이어그램이다.

`Entity` : 실체, 독립체 즉, 객체
`Relationship` : 관계
`Diagram` : 정보를 그림으로 표시한 것

### 📖 엔티티 (Entity)
- 엔티티는 **정의가능한 사물 또는 개념**을 의미한다.
ex) 도서 정보, 주문 정보
- **데이터베이스의 테이블**이 엔티티로 표현된다.

#### 📒 엔티티 속성
엔티티는 개체의 속성(Attribute)를 가진다.
Null을 허용하지 않을 때 👉 엔티티 도메인에 N이나 NN을 쓴다.

#### 📒 엔티티 도메인(선택사항)
속성의 값, 타입, 제약 사항 등에 대한 값의 범위를 표현하는 것이다. 


### 📖 ERD키와 제약 조건 표기법
#### 📒 주 식별자 (PK)
- 데이터베이스 테이블의 Primary Key

**✅ PK의 조건**
1. 중복이 없어야 한다.
2. 비어있어서 안된다. 


**✏️ 표현방법**
PK나 ◆ 다이아몬드로 표현하기도 하고 아니면 열쇠로도 표현하기도 한다.
그리고 주 식별자는 유일한 속성이므로 다른 속성과의 명확한 구분을 위해 구분선을 두기도 한다.

#### 📒  외래 식별자 (FK)
- 데이터베이스 테이블의 Foreign Key를 표현

### 📖 식별자 관계 vs 비식별자 관계
**부모의 키를 자식에서 PK로 사용하는지 일반 속성으로 사용하는지**에 따라서 관계가 달라진다.

#### 📒 식별자 관계
- 실선으로 표현한다.
- 부모자식의 관계에서 자식이 부모의 주 식별자(PK)를 외래 식별자(FK)로 참조해서, **자신의 주 식별자로 설정**한다.

✍️ 실제예시
<img  width =400 src = "https://velog.velcdn.com/images/sseohyun_0v0/post/ec7e6d76-396a-423f-981f-1a6937594afd/image.png">
👉 자식 엔티티(학생별 취미)가 부모 엔티티(학생)의 주식별자(학번)을 **자신의 주 식별자로 설정**하였다.

#### 📒 비식별자 관계
- 점선으로 표현한다.
- 부모자식 관계에서 자식이 부모의 주 식별자(PK)를 외래 식별자(FK)로 참조해서, **일반 속성으로 사용**한다. 

✍️ 실제 예시
<img  width =400 src = "https://velog.velcdn.com/images/sseohyun_0v0/post/b14517b5-fa4a-4568-b7bd-f532d409d4e0/image.png">
👉 자식 엔티티(사원정보)가 부모 엔티티(부서정보)의 부서코드를 **일반 속성으로 두었다.**


### 📖 ERD관계

- `One to one`
하나가 하나의 정보를 갖는다.
- `One to many`
한명의 학생은 여러개의 취미를 가질 수 있다.
- `Many to many`
제품은 여러 제조업체에서 나올 수 있고, 제조업체는 여러 제품을 가질 수 있다.

#### ⚠️ Many-to-Many 관계의 해소
- 데이터 모델링에서는 M:N 관계를 완성되지 않은 모델로 간주하여, 두 엔티티의 관계를 1:N, N:1 로 조정하는 작업이 필요하다.
- 따라서 두 엔티티의 관련성을 표현하기 위해서는 중간에 또 다른 엔티티를 필요로 한다. 이 중간 엔티티(업체별 제품)가 두 엔티티의 공유 속성 역할을 하게 된다.
<img  width =600 src = "https://velog.velcdn.com/images/sseohyun_0v0/post/44dda4c9-ef27-40c8-9085-1baabb5c25d0/image.png">

### 📖 ERD 관계의 참여도 
관계선 각 측의 끝자락에 기호를 표시한다.

- 필수 관계 `∣` 
어느 한 쪽이 존재하면 다른 쪽도 반드시 존재해야 하는 관계를 필수 관계 기호를 사용한다.

- 선택 관계  `○`
대응 되는 인스턴스가 있을 수도 있고 없을 수도 없을 때 선택 관계 기호를 사용한다.
<img src = "https://velog.velcdn.com/images/sseohyun_0v0/post/8ee59175-31a6-42d7-b97f-5669b6e78bf2/image.png
" width =600>

### 📖 관계 총 정리
![](https://velog.velcdn.com/images/sseohyun_0v0/post/a656a1ec-e352-4d60-b0b1-04a7ca756262/image.png)


***
#### 🔍 엔티티의 부모 자식 관계
🤔 부모 자식간의 관계가 어떻게 성립할까 의문이 들었다
👉 나는 다대다의 관계에서 부모자식관의 관계를 어떻게 설명해야하는지 궁금했던 것인데, 알고보니 ERD에서는 다대다의 관계는 미완으로 보고 수정을 해야하는 것이였다.
또한 1대1의 관계에서도 어느 하나가 부모의 역할을 한다고 한다.

# 1주차 과제 
## 쇼핑몰 ERD(Entity-Relationship Diagram) 설계 과제 
**🎯목표**
상품, 주문, 사용자등의 엔티티와 그들 사이의 관계를 정의

### 🤔생각해보기**
**엔티티**
- 사용자 : 사용자ID, 주소, 사용자이름
- 상품 : 상품ID, 스타일, 가격, 색상 
- 쇼핑몰(판매자) : 쇼핑몰ID, 스타일
- 주문 : 주문ID, 상품ID, 쇼핑몰ID, 사용자ID, 결제가격, 배송ID, 주소
- 배송 : 배송ID, 배달회사, 쇼핑몰ID, 사용자ID, 주소
- 쇼핑몰 상품 : 쇼핑몰ID
- 주문의 상품 : 주문ID, 상품ID, 갯수

**관계**
- 구매자 -> 주문 : 한 구매자는 0또는 하나 이상의 주문으로 이루어져있다.
- 주문 -> 구매자 : 한 주문은 하나의 구매자로 이루어져있다. 


- 주문-> 배송 : 한 주문은 하나이상의 배송으로 이루어져있다.
- 배송-> 주문 : 한 배송은 한 주문으로 이루어져있다.

#### 🤔 중간엔티티
```
- 주문-> 주문의 상품 : 한 주문은 하나이상의 주문의 상품으로 이루어져있다.
- 주문의 상품 -> 주문 : 한 주문의 상품은 한 주문으로 이루어져있다.


- 상품 -> 주문의 상품 : 한 상품은 0또는 하나이상의 주문으로 이루어져있다.
- 주문의 상품 -> 상품 : 주문의 상품은 한 상품로 구성되어있다. (개수는 속성으로 부여함)


- 쇼핑몰의 상품 -> 상품 : 한 쇼핑몰의 상품은 하나의 상품을 가지고 있다. 
- 상품 -> 쇼핑몰의 상품 : 한 상품은 하나또는 여러개의 쇼핑몰의 상품으로 이루어져있다. 


- 쇼핑몰의 상품 -> 쇼핑몰 : 한 쇼핑몰의 상품은 하나의 쇼핑몰을 가지고 있다.
- 쇼핑몰-> 쇼핑몰의 상품 : 한 쇼핑몰은 0또는 여러개의 상품을 가지고 있다.
```

**ERD**
![](https://velog.velcdn.com/images/sseohyun_0v0/post/2f454a61-fa5f-4295-844a-902f910e583e/image.png)

## 추가로 생각해보기

## 🤔 중간엔티티를 두는 경우 
- 한 상품이 여러 쇼핑몰에서 판매될 수 있는 경우
- 같은 상품이 쇼핑몰 별(판매자별)로 정보가 다른 경우 (네이버에서의 같은 물건 가격 리스트)
 ( 이런 경우가 아니라면 설계 복잡도와 데이터 베이스 조회시에 성능이 저하 될 수 있다.)

## 🤔 주소 속성 생각해보기
주소 속성이 사용자, 주문, 배송에 각각 존재한다. 만약 사용자가 한개의 주소만 가지고 고정적으로 사용한다면 주문엔티티와, 배송 엔티티는 사용자 엔티티에 연결되어 있기 때문에 참조할 수 있다.
💡 참조할 수 있구나!! 

👉 사용자는 주소값이 바뀔 수 있고, 주문시에만 주소 속성을 사용하면 되니까 주문엔티티에만 주소속성을 넣고, 배송 엔티티에서 주소 ID를 가지고 참조를 하면 더 좋을 것 같습니다...!

## 👨‍🏫 comment
1. 주소 엔티티를 따로 만든다.
2. 회원의 id 를 fk로 들고있다.
3. 회원은 여러 주소를 가지고 있다.
4. 주문 하는 경우에는 회원은 주소id를 이용해 주문을 저장한다.
5. 만약 회원이 이전에 주소A로 저장을 해놓았지만 현재 이사를 가서 더이상 사용하지 않아서 A를 삭제했다. -> 하지만 주문 내역에서는 이전주소가 보여야한다
6. 기존 방식으로 구현을 한다면 주소 삭제를 한다면 이전에 진행했던 주문에 주소가 보이지 않을까요?(cascade 옵션)
7. 회원이 기존 주소를 삭제하는 경우 실제로 삭제를 하는 것이 아니라 회원이 해당 주소에 더이상 접근하지 못하게(논리 삭제;soft delete)만 8. 로직을 구현해두면 주문 목록에서는 배송지가 남아있게됩니다.

**Q. 이러한 방식의 구현방법은 어떠한 장단점이 있을까요?**

### 📖  cascade
caecade는 SQL에서 참조 무결성을 지켜주기 위해 사용하는 옵션이다.

✅ 참조 무결성이란, 데이터베이스 상의 참조가 모두 유효함을 뜻한다.

즉 참조관계에 있는 부모 테이블을 삭제하거나 수정할 때, 자식테이블도 삭제, 수정되도록 하는 옵션이다. 

#### ⚠️ 주소 속성이 참조관계에 있을 경우의 문제점
주소 속성의 참조관계에 있는 속성을 지우면 이전 주소 정보들이 삭제 된다.
주소 데이터는 탈퇴한 사용자의 정보처럼 영구적으로 불필요한 정보가 아니라 쓰일 가능성(?)이 있는 정보기 때문에 삭제해서는 안된다.
따라서 참조관계는 위험(?)함.

👉 참조관계에 있는 엔티티는 종속적이므로 쉽게 삭제되면 안되는 엔티티는 참조관계로 두지 않아야한다...?

### 📖  논리삭제와 물리삭제
- 물리삭제 : SQL DELETE 명령을 사용해 직접 데이터를 삭제하는 방식

- 논리삭제 : 논리적인 개념의 컬럼을 추가하고 해당 컬럼을 UPDATE 실행

논리삭제의 장단점은 각각 물리삭제의 단장점입니다.
**🙆‍♂️ 논리삭제의 장점**
- 삭제된 데이터를 SELECT로 조회할 수 있기 때문에 물리적으로 삭제하는 물리삭제보다는 조금더 데이터 관리상 안전하다.

**🙅 논리삭제의 단점**
- 물리적으로 한번 쌓인 데이터는 삭제하지 못하는 구조이기 때문에 **데이터베이스의 용량이 매우 비대해질 수 있다.**

**👏 논리삭제가 적절한 경우**
- 특정 정보가 완전히 불필요하지 않다고 판단되는 정보를 삭제하는 경우
- __통계에 쓰여야하는 경우__

**👏 물리삭제가 적절한 경우**
- 데이터가 자주 바뀌고, 추후에 완전히 불필요한 정보거나 완전히 삭제해야할 필요가 있는 정보

#### 🧐 주소 데이터의 삭제는 어떤 삭제가 적절할까?
👉 물리삭제가 아닌 논리삭제가 적절하다.
주소 데이터는 주문 목록이나, 배달 정보확인등 필요한 데이터이기 때문에 물리적으로 삭제되면 안됩니다. 그런데 주소 데이터를 식별관계로 둔다면 물리삭제의 위험이 생기기 때문에 비식별관계로 두어야 하고, 삭제를 할 경우에는 논리삭제를 해야합니다.







### 러프한 ERD

- **키 속성** - 타원에 밑줄

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c4539d8b-6b56-4653-bfcc-2ac818626fda/Untitled.png)

1. 영화는 제목, 발매년월 등의 속성이 필요하다.
2. 영화는 장르로 구분할 수 있다.
3. 영화는 감독으로 구분할 수 있다.
    -  감독은 성/이름으로 속성이 나뉘어 있다.
4. 영화는 배우로 구분할 수 있다.
    -  배우는 성/이름 과 성별로 속성이 나뉘어 있다.
5. 감독, 배우, 장르로 구분을 하였지만 왜 발매년월로는 따로 속성을 만들지 않을까?


#### 🤔 발매년월도가 엔티티가 못 된 이유?!
### 엔터티의 특징 요약
1. 유일한 식별자에 의해 식별 가능해야 한다. (EX. 성별 같은 식별자는 중복성이 커서 불가능함)
2. 2개 이상의 인스턴스(속성)의 집합이어야 한다.
3. 엔터티는 반드시 업무 프로세스에 의해 이용된다.
4. 반드시 속성을 가져야 한다. 그리고 1개의 엔터티는 무조건 2개 이상의 속성을 가진다.
5. 엔터티는 다른 엔터티와 최소한 1개 이상의 관계를 맺는다.
6. 엔터티 명은 약어를 지양해야 한다.

#### 🤔 발매년월도가 엔터티로 적절하지 않은 이유
1. 업무 프로세스에 이용되지 않는다.
2. 2개이상의 속성을 가지지 못한다. 

### 🤔 궁금한 점
ERDplus로 식별관계를 나타내는 방법 => 실선의 마름모

